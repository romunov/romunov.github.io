<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Biolitika - grepl</title>
        <link rel="stylesheet" href="https://biolitika.si/theme/css/main.css" />
        <link href="https://biolitika.si/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Biolitika Atom Feed" />
        <link href="https://biolitika.si/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Biolitika RSS Feed" />
          <link href="https://biolitika.si/feeds/{slug}.rss.xml" type="application/rss+xml" rel="alternate" title="Biolitika Tags RSS Feed" />
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://biolitika.si/">Biolitika </a></h1>
                <nav><ul>
                    <li><a href="https://biolitika.si/category/howto.html">HowTo</a></li>
                    <li><a href="https://biolitika.si/category/ijz.html">IJZ</a></li>
                    <li><a href="https://biolitika.si/category/opensource.html">OpenSource</a></li>
                    <li><a href="https://biolitika.si/category/razmisljanja.html">Razmi≈°ljanja</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://biolitika.si/vectorizing-functions-in-r-is-easy.html">Vectorizing functions in R is easy</a></h1>
<footer class="post-info">
        <span>2019-04-17</span>
<span>| tags: <a href="https://biolitika.si/tag/r.html">R</a><a href="https://biolitika.si/tag/vectorization.html">vectorization</a><a href="https://biolitika.si/tag/vectorize.html">Vectorize</a><a href="https://biolitika.si/tag/regex.html">regex</a><a href="https://biolitika.si/tag/0dependencies.html">0dependencies</a><a href="https://biolitika.si/tag/grepl.html">grepl</a><a href="https://biolitika.si/tag/sapply.html">sapply</a></span>
</footer><!-- /.post-info --><p>Imagine you have a function that only takes one argument, but you would really like to work on a vector of values. A short example on how function <code>Vectorize()</code> can accomplish this. Let's say we have a <code>data.frame</code></p>
<div class="highlight"><pre><span></span><code><span class="n">xy</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">sample</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;C_pre_sample1&quot;</span><span class="p">,</span> <span class="s">&quot;C_post_sample1&quot;</span><span class="p">,</span> <span class="s">&quot;T_pre_sample2&quot;</span><span class="p">,</span>
                            <span class="s">&quot;T_post_sample2&quot;</span><span class="p">,</span> <span class="s">&quot;NA_pre_sample1&quot;</span><span class="p">),</span>
                 <span class="n">value</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="m">5</span><span class="p">))</span>

<span class="c1">#           sample     value</span>
<span class="c1"># 1  C_pre_sample1 0.3048032</span>
<span class="c1"># 2 C_post_sample1 0.3487163</span>
<span class="c1"># 3  T_pre_sample2 0.3359707</span>
<span class="c1"># 4 T_post_sample2 0.6698358</span>
<span class="c1"># 5 NA_pre_sample1 0.9490707</span>
</code></pre></div>


<p>and you want to subset only samples that start with <code>C_pre</code> or <code>T_pre</code>. Of course you can construct a nice regular expression, implement an anonymouse function using <code>lapply</code>/<code>sapply</code> or use one of those fancy tidyverse functions.</p>
<p>A long winded way would be to find matches using regular expression for each level, combine them and subset. This is for pedagogical reasons, so please bare with me.</p>
<div class="highlight"><pre><span></span><code><span class="n">i</span><span class="p">.</span><span class="n">ind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">do</span><span class="p">.</span><span class="k">call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span><span class="w"> </span><span class="k">list</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">grepl</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^C_pre&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xy$sample</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="n">grepl</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^T_pre&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xy$sample</span><span class="p">)</span><span class="w"></span>
<span class="p">))</span><span class="w"></span>

<span class="n">i</span><span class="p">.</span><span class="n">ind</span><span class="w"></span>
<span class="c1">#       [,1]  [,2]</span><span class="w"></span>
<span class="c1"># [1,]  TRUE FALSE</span><span class="w"></span>
<span class="c1"># [2,] FALSE FALSE</span><span class="w"></span>
<span class="c1"># [3,] FALSE  TRUE</span><span class="w"></span>
<span class="c1"># [4,] FALSE FALSE</span><span class="w"></span>
<span class="c1"># [5,] FALSE FALSE</span><span class="w"></span>

<span class="c1"># Find those rows in `xy` that have at least one TRUE and use that to subset the</span><span class="w"></span>
<span class="c1"># data.frame.</span><span class="w"></span>
<span class="n">xy</span><span class="err">[</span><span class="n">rowSums</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ind</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">]</span><span class="w"></span>

<span class="c1">#          sample     value</span><span class="w"></span>
<span class="c1"># 1 C_pre_sample1 0.3048032</span><span class="w"></span>
<span class="c1"># 3 T_pre_sample2 0.3359707</span><span class="w"></span>
</code></pre></div>


<p>The same can be achieved using a <em>vectorized</em> version of the <code>grepl</code> function. We designate which argument exactly is being vectorized, in our case <code>pattern</code> because that's the argument that is varying.</p>
<div class="highlight"><pre><span></span><code><span class="n">vgrepl</span> <span class="o">&lt;-</span> <span class="nf">Vectorize</span><span class="p">(</span><span class="n">grepl</span><span class="p">,</span> <span class="n">vectorize.args</span> <span class="o">=</span> <span class="s">&quot;pattern&quot;</span><span class="p">)</span>
</code></pre></div>


<p>Here we use function <code>Vectorize</code> and we tell it to vectorize argument <code>pattern</code>. What this will do is run the <code>grepl</code> function for any element of the vector we pass in, just like we did in the <code>i.ind</code> objects a few lines above.</p>
<p>This would be an equivalent of doing it using an anonymouse function</p>
<div class="highlight"><pre><span></span><code><span class="n">tmp</span> <span class="o">&lt;-</span> <span class="nf">sapply</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;^C_pre&quot;</span><span class="p">,</span> <span class="s">&quot;^T_pre&quot;</span><span class="p">),</span> <span class="n">FUN</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">grepl</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">input</span><span class="p">)</span>
<span class="p">},</span> <span class="n">input</span> <span class="o">=</span> <span class="n">xy</span><span class="o">$</span><span class="n">sample</span><span class="p">)</span>

<span class="n">tmp</span>
<span class="c1">#      ^C_pre ^T_pre</span>
<span class="c1"># [1,]   TRUE  FALSE</span>
<span class="c1"># [2,]  FALSE  FALSE</span>
<span class="c1"># [3,]  FALSE   TRUE</span>
<span class="c1"># [4,]  FALSE  FALSE</span>
<span class="c1"># [5,]  FALSE  FALSE</span>
</code></pre></div>


<p>While this can be somewhat verbose, you can use <code>vgrepl</code> as you would use <code>grepl</code>, with the minor detail that you pass a whole vector to <code>pattern</code> instead of a single regular expression.</p>
<div class="highlight"><pre><span></span><code><span class="n">i.vec</span> <span class="o">&lt;-</span> <span class="nf">vgrepl</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;^C_pre&quot;</span><span class="p">,</span> <span class="s">&quot;^T_pre&quot;</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="o">$</span><span class="n">sample</span><span class="p">)</span>
<span class="c1">#      ^C_pre ^T_pre</span>
<span class="c1"># [1,]   TRUE  FALSE</span>
<span class="c1"># [2,]  FALSE  FALSE</span>
<span class="c1"># [3,]  FALSE   TRUE</span>
<span class="c1"># [4,]  FALSE  FALSE</span>
<span class="c1"># [5,]  FALSE  FALSE</span>

<span class="n">xy</span><span class="p">[</span><span class="nf">rowSums</span><span class="p">(</span><span class="n">i.vec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="p">]</span>

<span class="c1">#          sample     value</span>
<span class="c1"># 1 C_pre_sample1 0.3048032</span>
<span class="c1"># 3 T_pre_sample2 0.3359707</span>
</code></pre></div>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>1995 style links</h2>
                        <ul>
                            <li><a href="https://stackoverflow.com/users/322912/roman-lu%C5%A1trik">visit me on StackOverFlow</a></li>
                            <li><a href="http://metinalista.si/category/metamorfoza">#metamorfoza podcast (SI)</a></li>
                            <li><a href="https://www.r-bloggers.com">r-bloggers</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://biolitika.si/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="https://biolitika.si/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS feed</a></li>
                            <li><a href="https://biolitika.si/feeds/{slug}.rss.xml" type="application/rss+xml" rel="alternate">Tag RSS feed</a></li>

                            <li><a href="https://github.com/romunov">GitHub</a></li>
                            <li><a href="https://twitter.com/romunov">Twitter</a></li>
                            <li><a href="https://www.linkedin.com/in/roman-lu%C5%A1trik-5a6586ab">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22752654-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>