<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Point arrows to specific parts of the data</title>
        <link rel="stylesheet" href="https://biolitika.si/theme/css/main.css" />
        <link href="https://biolitika.si/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Biolitika Atom Feed" />
        <link href="https://biolitika.si/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Biolitika RSS Feed" />
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://biolitika.si/">Biolitika </a></h1>
                <nav><ul>
                    <li class="active"><a href="https://biolitika.si/category/howto.html">HowTo</a></li>
                    <li><a href="https://biolitika.si/category/ijz.html">IJZ</a></li>
                    <li><a href="https://biolitika.si/category/opensource.html">OpenSource</a></li>
                    <li><a href="https://biolitika.si/category/razmisljanja.html">Razmi≈°ljanja</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://biolitika.si/point-arrows-to-specific-parts-of-the-data.html" rel="bookmark"
           title="Permalink to Point arrows to specific parts of the data">Point arrows to specific parts of the data</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>2018-04-14</span>
<span>| tags: <a href="https://biolitika.si/tag/r.html">R</a><a href="https://biolitika.si/tag/ggplot2.html">ggplot2</a><a href="https://biolitika.si/tag/approximation.html">approximation</a><a href="https://biolitika.si/tag/interpolation.html">interpolation</a><a href="https://biolitika.si/tag/arrow.html">arrow</a><a href="https://biolitika.si/tag/datum.html">datum</a><a href="https://biolitika.si/tag/asdate.html">as.Date</a></span>
</footer><!-- /.post-info -->      <p>tl;dr: Point arrows at your line at defined datum points.</p>
<p>Sometimes to really enhance your picture you need to point at some stuff. Here is a script which will plot vertical lines to show events in your datum plot.</p>
<div class="highlight"><pre><span></span><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w"></span>

<span class="c1"># This script will draw points to parts of (interpolated) lines.</span><span class="w"></span>

<span class="n">arrow</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="n">touchoff</span><span class="o">.</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="c1"># distance between data and start of arrow</span><span class="w"></span>
<span class="n">arrowhead</span><span class="o">.</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mf">2.5</span><span class="w"> </span><span class="c1"># in millimeters</span><span class="w"></span>

<span class="c1"># Simulate some data.</span><span class="w"></span>
<span class="n">set</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"></span>
<span class="n">datum</span><span class="o">.</span><span class="n">seq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">as</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">                 </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">as</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;2018-12-31&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">                 </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2 week&quot;</span><span class="p">)</span><span class="w"></span>

<span class="n">xy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">datum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rep</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="n">xy</span><span class="o">$</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span><span class="w"> </span><span class="nb">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span><span class="w"></span>
<span class="w">              </span><span class="n">runif</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span><span class="w"> </span><span class="nb">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="n">xy</span><span class="o">$</span><span class="n">var1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rep</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;s2&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">seq</span><span class="p">))</span><span class="w"></span>

<span class="c1"># These are the points where we want to point to.</span><span class="w"></span>
<span class="n">topoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">datum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"></span>
<span class="w">                      </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rep</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;s2&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">))</span><span class="w"></span>

<span class="c1"># Function which interpolates per one variable.</span><span class="w"></span>
<span class="n">interpolateOnDate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">newdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">newdata</span><span class="p">[</span><span class="n">newdata</span><span class="o">$</span><span class="n">var1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">xy</span><span class="o">$</span><span class="k">var</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">approx</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xy</span><span class="o">$</span><span class="n">datum</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xy</span><span class="o">$</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">xout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newdata</span><span class="o">$</span><span class="n">datum</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">newdata</span><span class="o">$</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">out</span><span class="o">$</span><span class="n">y</span><span class="w"></span>
<span class="w">  </span><span class="n">newdata</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1"># Apply interpolation to each level of var1</span><span class="w"></span>
<span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xy</span><span class="o">$</span><span class="n">var1</span><span class="p">),</span><span class="w"></span>
<span class="w">              </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interpolateOnDate</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">topoint</span><span class="p">)</span><span class="w"></span>

<span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="c1"># merge result</span><span class="w"></span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datum</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">  </span><span class="n">geom_path</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datum</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">touchoff</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datum</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">touchoff</span><span class="o">.</span><span class="n">distance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arrow</span><span class="o">.</span><span class="n">length</span><span class="p">),</span><span class="w"></span>
<span class="w">               </span><span class="n">arrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrow</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="n">arrowhead</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mm&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ends</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;first&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">var1</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p><img alt="Point to data with arrows using linear approximation and ggplot2" src="https://biolitika.si/images/point_to_data.jpeg"></p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>1995 style links</h2>
                        <ul>
                            <li><a href="https://stackoverflow.com/users/322912/roman-lu%C5%A1trik">visit me on StackOverFlow</a></li>
                            <li><a href="http://metinalista.si/category/metamorfoza">#metamorfoza podcast (SI)</a></li>
                            <li><a href="https://www.r-bloggers.com">r-bloggers</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://biolitika.si/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="https://biolitika.si/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS feed</a></li>
                            <li><a href="https://biolitika.si/feeds/{slug}.rss.xml" type="application/rss+xml" rel="alternate">Tag RSS feed</a></li>

                            <li><a href="https://github.com/romunov">GitHub</a></li>
                            <li><a href="https://twitter.com/romunov">Twitter</a></li>
                            <li><a href="https://www.linkedin.com/in/roman-lu%C5%A1trik-5a6586ab">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22752654-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>